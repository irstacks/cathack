<html>
  <head>
    <title>HackChat</title>
  </head>

  <!-- bootstrap -->
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

  <!-- octicons? -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/octicons/3.5.0/octicons.min.css">

  <!-- jquery -->
  <script   src="https://code.jquery.com/jquery-3.0.0.min.js"   integrity="sha256-JmvOoLtYsmqlsWxa7mDSLMwa6dZ9rrIdtrrVYRnDRH0="   crossorigin="anonymous"></script>

  <!-- highlightjs   -->
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.5.0/styles/default.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.5.0/highlight.min.js"></script>

  <style>
    
  </style>

  <body>

    <div class="container-fluid">
      <h1 style="color: #BEE0FC;">/hack <i class="octicon octicon-octocat"></i></h1>

      <div id="draft" contenteditable="true" style="min-height: 60vh; width: 60%;">
        write here
      </div>

    </div>

    <script>
      
      var url = "ws://" + window.location.host + "/hack/ws";
      var ws = new WebSocket(url);
      var draft = $("#draft");
      var typo = $("#typo");
      function highlighter() {
        // highlight.js each pre
        $('#draft').each(function(i, block) {
          hljs.highlightBlock(block);
        });
      }
      ws.onmessage = function (msg) {
        var d = msg.data;
        console.log("received onmessage -> " + d);
        draft.html(d);  
        // highlighter();
      };

      $(document).keyup(function (e) {
        if (!e.shiftKey && e.which == 13) {
          
          var t = draft.html();
          console.log("sending " + t);
          ws.send(t);
          // highlighter();
        }
      })
      $(function () {
        highlighter();
      });

      // pingpongers
      // draft.bind("DOMSubtreeModified", function () {
      //   console.log('changed');
      //   var t = draft.html();
      //   console.log('t -> ' + t);
      //   ws.send(draft.html());
      // });

    </script>
    

  </body>
</html>
