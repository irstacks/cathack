<html>
  <head>
    <title>CatChat</title>
  </head>

  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

  <!-- jquery -->
  <script   src="https://code.jquery.com/jquery-3.0.0.min.js"   integrity="sha256-JmvOoLtYsmqlsWxa7mDSLMwa6dZ9rrIdtrrVYRnDRH0="   crossorigin="anonymous"></script>

  <style>
    body {
      background-color: black;
    }
    pre {
      border: none;
    }
    #chat {
      text-align: left;
      background: black;
      color: lightgreen;
      width: 100%;
      padding: 20px;
      
      /*autoscrolalble*/
      height: 80vh;
      overflow: auto;
    }
    .input-holder {
      position: fixed;
      bottom: 0;
      width: 100%;
      padding: 2rem;
    }
    input#text {
      background: black;
      border: none;
      color: lightgreen;
    }
  </style>

  <iframe id="frmFile" src="chat.txt" onload="LoadFile();" style="display: none" ></iframe>

  <body>

    <div class="container-fluid">
      <div class="row">
        <div class="col-sm-12">
          <pre id="chat"></pre> 
          <div class="input-holder" >
            <div class="form-group">
              <label for="text">Echo</label>
              <input class="form-control" placeholder="say something" id="text" type="text">  
            </div>  
          </div>
          
        </div>
        
      </div>
    </div>


<script type="text/javascript">

var chat = document.getElementById("chat");
//Seems like this might not be the way to handle loadin up a text file
function LoadFile() {
    var oFrame = document.getElementById("frmFile");

    var strRawContents = oFrame.contentWindow.document.body.childNodes[0].innerHTML;
    var arrLines = strRawContents.split("\n");
    for (var i = 0; i < arrLines.length; i++) {
        var curLine = arrLines[i];
        chat.innerText += curLine +"\n";
    }
}

</script>



    <script>
      var url = "ws://" + window.location.host + "/ws";
      var ws = new WebSocket(url);
      var name = "Guest" + Math.floor(Math.random() * 1000);
      var chat = document.getElementById("chat");
      var text = document.getElementById("text");
      var now = function () {
        var iso = new Date().toISOString();
        return iso.split("T")[1].split(".")[0];
      };

      function scrollChat() {
        var div = $('#chat');
        div.scrollTop(div.prop('scrollHeight'));
      }

      ws.onmessage = function (msg) {
        var line =  msg.data + "\n";
        chat.innerText += line;
        scrollChat(); // set to bottom nicelike
      };
      text.onkeydown = function (e) {
        if (e.keyCode === 13 && text.value !== "") {
          ws.send(" $ " + text.value);
          text.value = "";
        }
      };

      // scroll to bottom on doc ready
      $(function () {
        scrollChat();
      });
    </script>
    

  </body>
</html>
